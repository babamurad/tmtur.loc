# Тур‑группы: задачи и чеклист

## Этап 1 — Маршрут и каркас страницы

Задачи
- [ ] Добавить маршрут `GET /tour-groups` (`routes/web.php`) с именем `front.tour-groups`.
- [ ] Создать `App\Livewire\Front\TourGroupsIndexComponent` с базовым рендером и layout `front-app`.
- [ ] Подготовить шаблон `resources/views/livewire/front/tour-groups-index.blade.php`.

Критерии готовности
- [ ] Страница открывается по `route('front.tour-groups')`.
- [ ] Используется единый фронт-лейаут и корректный заголовок.

## Этап 2 — Список групп и фильтры

Задачи
- [ ] Реализовать загрузку `TourGroup::with('tour')` с пагинацией.
- [ ] Добавить фильтр по месяцу `month` и году `year` (`whereMonth/whereYear`).
- [ ] Значения по умолчанию — текущие месяц/год; «Все» сбрасывает фильтр.

Критерии готовности
- [ ] Список обновляется без перезагрузки (Livewire).
- [ ] Пагинация работает совместно с фильтрами.

## Этап 3 — Карточка группы и UI

Задачи
- [ ] Показать: название тура, дату/время старта, свободные места.
- [ ] Показать цены: `price_max` (1 человек) и `price_min` (`max_people` человек).
- [ ] Кнопка «Забронировать» активна только при наличии мест.

Критерии готовности
- [ ] Цвет бейджа мест зависит от процента доступности.
- [ ] Нет мест → кнопка неактивна.

## Этап 4 — Модальное бронирование и валидация

Задачи
- [ ] Открывать модал по клику «Забронировать», передавать `tour_group_id`.
- [ ] Поля: `name`, `email`, `phone?`, `comment?`, `people_count`, `hp`.
- [ ] Валидация: `name/email` обязательны; `people_count ≥ 1`; `hp` — honeypot.
- [ ] Проверка доступных мест перед отправкой.

Критерии готовности
- [ ] Неуспех валидации — сообщения об ошибках без закрытия модала.
- [ ] Недостаточно мест — информирование и запрет отправки.

## Этап 5 — Сохранение и email

Задачи
- [ ] Сохранить запись в `App\Models\ContactMessage` с `ip` и `user_agent`.
- [ ] Сформировать сообщение с данными тура, даты, людей и пользователя.
- [ ] Отправить письмо через `App\Mail\ContactReceived` на `MAIL_TO_ADDRESS`.
- [ ] Диспатчить `messagesUpdated` для обновления бейджа в навигации.

Критерии готовности
- [ ] Запись появляется в таблице сообщений.
- [ ] Письмо уходит (проверка лога/тестового ящика).

## Этап 6 — I18n и полировка UI

Задачи
- [ ] Добавить недостающие ключи переводов (`messages.*`).
- [ ] Выровнять стили карточек и модала с существующим фронтом.

Критерии готовности
- [ ] Русский/английский тексты отображаются корректно.
- [ ] Консистентный внешний вид.

## Этап 7 — Проверка и тестирование

Чеклист
- [ ] Фильтрация по месяцу/году и совместимость с пагинацией.
- [ ] Открытие/закрытие модала, валидация, UX состояний отправки.
- [ ] Сохранение в БД, обновление бейджа «Сообщения».
- [ ] Отправка письма и корректное содержимое шаблона.
- [ ] Поведение при отсутствии `MAIL_TO_ADDRESS` — лог‑предупреждение, без влияния на UX.

## Связанные файлы
- `routes/web.php`
- `app/Livewire/Front/TourGroupsIndexComponent.php`
- `resources/views/livewire/front/tour-groups-index.blade.php`
- `app/Models/TourGroup.php`, `app/Models/Tour.php`
- `app/Models/ContactMessage.php`
- `app/Mail/ContactReceived.php`
- `resources/views/emails/contact-received.blade.php`
- `resources/views/livewire/front/tours-show.blade.php`

## Статус‑трекер (пример)
- Этап 1 — Маршрут и каркас: Planned
- Этап 2 — Список и фильтры: Planned
- Этап 3 — Карточка и UI: Planned
- Этап 4 — Модал и валидация: Planned
- Этап 5 — Сохранение и email: Planned
- Этап 6 — I18n и полировка: Planned
- Этап 7 — Проверка: Planned

