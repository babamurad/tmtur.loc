# Генератор Ссылок и Отслеживание Переходов

## Описание
Генератор ссылок позволяет создавать уникальные URL с UTM-метками для отслеживания источников трафика. Система автоматически подсчитывает количество переходов по каждой сгенерированной ссылке.

## Как использовать

### Создание ссылки
1. Перейдите в раздел **Инструменты -> Генератор ссылок**.
2. В поле **Целевая страница** введите URL страницы, на которую должен попасть пользователь (например, `https://tmtourism.com/tours/ashgabat`).
3. В поле **Источник (Source)** укажите идентификатор источника (например, `instagram`, `facebook`, `newsletter_may`). Это значение будет добавлено в параметр `utm_source`.
4. Нажмите кнопку **Сгенерировать**.
5. Скопируйте полученную ссылку.

### Просмотр статистики
В таблице "История" отображаются все созданные ссылки.
- **Дата**: Дата и время создания ссылки.
- **Источник**: Значение `utm_source`.
- **Владелец**: Пользователь, к которому привязана ссылка. Если пользователь не найден, отображается "Не назначен".
- **Ссылка**: Полная сгенерированная ссылка и целевая страница.
- **Переходы**: Количество переходов по данной ссылке.

## Синхронизация Пользователей

Эта функция полезна, когда реферальные ссылки были созданы для партнеров до их регистрации на сайте.

### Как это работает:
1. Нажмите кнопку **Синхронизация** в верхней части страницы.
2. Система найдет все ссылки, у которых еще нет владельца.
3. Система попытается найти пользователя в базе данных, сопоставляя поле `Источник (Source)` с:
    - **Email** пользователя.
    - **Именем** пользователя (регистр не важен).
4. При совпадении ссылка автоматически привязывается к найденному пользователю.
5. Вы увидите уведомление о количестве привязанных ссылок.

## Техническая реализация
- **Middleware**: `App\Http\Middleware\TrackGeneratedLinkClicks` перехватывает все запросы.
- **Логика**: Если в запросе присутствует параметр `utm_source`, система ищет соответствующую запись в базе данных (по совпадению `utm_source` и `target_url`) и увеличивает счетчик `click_count`.
- **База данных**: Таблица `generated_links` хранит информацию о ссылках, счетчик переходов и ID владельца (`user_id`).
