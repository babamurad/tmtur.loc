# План реализации функционала отзывов

## Описание цели
Реализовать полноценную систему отзывов/тестимониалов для туров.
В настоящее время существует базовая структура (миграция, модель, интерфейс админа), но отсутствуют:
1. Интеграция с фронтендом (пользователи не видят и не могут оставлять отзывы).
2. Модерация (нет возможности одобрить/скрыть отзывы).
3. Элементы управления модерацией в админке.

Этот план направлен на устранение этих пробелов, позволяя авторизованным пользователям оставлять отзывы, а администраторам — модерировать их.

## Требуется проверка пользователем
> [!IMPORTANT]
> Пользователи должны быть авторизованы, чтобы оставить отзыв, так как схема базы данных требует корректный `user_id`.

## Предлагаемые изменения

### База данных
#### [NEW] [add_is_active_to_reviews_table](file:///c:/OSPanel/domains/tmtur.loc/database/migrations/xxxx_xx_xx_xxxxxx_add_is_active_to_reviews_table.php)
- Добавить `boolean('is_active')->default(false)` в таблицу `reviews`.

### Модели
#### [MODIFY] [Review](file:///c:/OSPanel/domains/tmtur.loc/app/Models/Review.php)
- Добавить `is_active` в `$fillable`.
- Добавить `scopeActive($query)` для фильтрации только одобренных отзывов.

### Livewire Компоненты (Фронтенд)
#### [NEW] [TourReviews](file:///c:/OSPanel/domains/tmtur.loc/app/Livewire/Front/TourReviews.php)
- Новый компонент для отображения отзывов конкретного тура и формы для отправки нового отзыва.
- Валидация и создание.
- Сообщение об успешной отправке (с пометкой "ожидает модерации").

#### [NEW] [tour-reviews.blade.php](file:///c:/OSPanel/domains/tmtur.loc/resources/views/livewire/front/tour-reviews.blade.php)
- Blade шаблон для компонента `TourReviews`.

### Livewire Компоненты (Админка)
#### [MODIFY] [ReviewIndexComponent](file:///c:/OSPanel/domains/tmtur.loc/app/Livewire/Reviews/ReviewIndexComponent.php)
- Добавить переключатель (toggle) или индикатор статуса `is_active`.
- Позволить модерацию прямо из списка.

#### [MODIFY] [ReviewEditComponent](file:///c:/OSPanel/domains/tmtur.loc/app/Livewire/Reviews/ReviewEditComponent.php)
- Добавить чекбокс/переключатель для поля `is_active`.

### Представления (Views)
#### [MODIFY] [tours-show.blade.php](file:///c:/OSPanel/domains/tmtur.loc/resources/views/livewire/front/tours-show.blade.php)
- Включить компонент `TourReviews` в нижней части страницы тура.
- `@livewire('front.tour-reviews', ['tour' => $tour])`

## План проверки

### Автоматические тесты
- Текущие тесты отсутствуют.
- Проверка будет выполняться вручную.

### Ручная проверка
1.  **Миграция**: Запустить `php artisan migrate`, проверить БД.
2.  **Админка**:
    -   Зайти в Админка -> Отзывы.
    -   Создать отзыв, проверить поле `is_active`.
    -   Проверить переключение статуса в списке.
3.  **Фронтенд**:
    -   Зайти как гость -> убедиться, что форма скрыта или просит войти.
    -   Зайти как юзер -> оставить отзыв -> убедиться, что он не появился сразу (модерация).
    -   Админка -> одобрить отзыв.
    -   Фронтенд -> убедиться, что отзыв появился.
